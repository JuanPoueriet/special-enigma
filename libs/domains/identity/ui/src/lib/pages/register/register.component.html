
    <div class="register-container">
      <div class="register-card">
        <!-- Progress Steps -->
        <div class="progress-steps">
          <div class="step" [class.active]="currentStep >= 1">1. País</div>
          <div class="step" [class.active]="currentStep >= 2">2. Personal</div>
          <div class="step" [class.active]="currentStep >= 3">3. Empresa</div>
          <div class="step" [class.active]="currentStep >= 4">4. Seguridad</div>
        </div>

        <h2>Registro Empresarial - {{ getCountryName() }}</h2>

        <!-- Context Warning Banner -->
        @if (contextAnalysis?.discrepancyLevel !== 'none') {
          <div class="context-banner" [class.warning]="contextAnalysis?.discrepancyLevel === 'low'" [class.danger]="contextAnalysis?.discrepancyLevel === 'high'">
            ⚠️ Detectamos que estás en {{ getCountryName(contextAnalysis?.detectedCountry || '') }}. ¿Estás seguro de registrarte en {{ getCountryName(country) }}?
          </div>
        }

        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">

          <!-- STEP 1: Country Selection -->
          @if (currentStep === 1) {
            <div>
              <virteex-country-selector (countrySelected)="onCountrySelected($event)"></virteex-country-selector>
              <div class="step-actions">
                <virteex-button (clicked)="nextStep()" [disabled]="!country">Continuar</virteex-button>
              </div>
            </div>
          }

          <!-- STEP 2: Personal Info -->
          @if (currentStep === 2) {
            <div>
              <h3>Información Personal</h3>
              <virteex-input label="Nombre" formControlName="firstName"></virteex-input>
              <virteex-input label="Apellido" formControlName="lastName"></virteex-input>
              <virteex-input label="Email Corporativo" formControlName="email" type="email"></virteex-input>

              <div class="step-actions">
                <virteex-button type="button" (clicked)="prevStep()" variant="secondary">Atrás</virteex-button>
                <virteex-button type="button" (clicked)="nextStep()" [disabled]="isStepInvalid(2)">Siguiente</virteex-button>
              </div>
            </div>
          }

          <!-- STEP 3: Company Info -->
          @if (currentStep === 3) {
            <div>
              <h3>Información de la Empresa</h3>
              <virteex-input label="Nombre de la Empresa" formControlName="companyName"></virteex-input>

              <virteex-input
                [label]="getTaxIdLabel()"
                formControlName="taxId"
                [placeholder]="getTaxIdPlaceholder()"
              ></virteex-input>
              <div class="hint">{{ getTaxIdHint() }}</div>

              <div class="step-actions">
                <virteex-button type="button" (clicked)="prevStep()" variant="secondary">Atrás</virteex-button>
                <virteex-button type="button" (clicked)="nextStep()" [disabled]="isStepInvalid(3)">Siguiente</virteex-button>
              </div>
            </div>
          }

          <!-- STEP 4: Security -->
          @if (currentStep === 4) {
            <div>
              <h3>Seguridad</h3>
              <virteex-input label="Contraseña" type="password" formControlName="password"></virteex-input>
              <div class="password-hint">Mínimo 12 caracteres, mayúscula, número y símbolo.</div>

              <div class="step-actions">
                <virteex-button type="button" (clicked)="prevStep()" variant="secondary">Atrás</virteex-button>
                <virteex-button type="submit" [disabled]="registerForm.invalid || loading" class="full-width">
                  {{ loading ? 'Registrando...' : 'Crear Cuenta' }}
                </virteex-button>
              </div>
            </div>
          }

        </form>

        @if (errorMsg) {
          <div class="error-banner">
            {{ errorMsg }}
          </div>
        }
      </div>
    </div>
