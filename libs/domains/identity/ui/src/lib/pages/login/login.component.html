
    <div class="login-container">
      <div class="login-card">
        <h2>{{ mfaRequired ? 'Verificación de Seguridad' : 'Iniciar Sesión' }}</h2>

        <!-- Context Warning (Only on initial login) -->
        <div *ngIf="!mfaRequired && contextAnalysis?.discrepancyLevel !== 'none'" class="context-banner" [class.warning]="contextAnalysis?.discrepancyLevel === 'low'" [class.danger]="contextAnalysis?.discrepancyLevel === 'high'">
          ⚠️ Accediendo desde {{ getCountryName(contextAnalysis?.detectedCountry) }} a cuenta {{ getCountryName(country) }}.
        </div>

        <div *ngIf="!mfaRequired">
            <lib-country-selector (countrySelected)="onCountrySelected($event)"></lib-country-selector>

            <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
            <lib-input
                label="Correo electrónico"
                formControlName="email"
                placeholder="nombre@empresa.com"
            ></lib-input>

            <lib-input
                label="Contraseña"
                type="password"
                formControlName="password"
                placeholder="******"
            ></lib-input>

            <lib-button type="submit" [disabled]="loginForm.invalid || loading" class="full-width">
                {{ loading ? 'Verificando...' : 'Iniciar Sesión' }}
            </lib-button>
            </form>
        </div>

        <div *ngIf="mfaRequired">
            <p class="mfa-instruction">Hemos detectado un intento de acceso inusual o su cuenta requiere verificación adicional. Ingrese el código enviado a su dispositivo.</p>
            <form [formGroup]="mfaForm" (ngSubmit)="onMfaSubmit()">
                <lib-input
                    label="Código de Verificación"
                    formControlName="code"
                    placeholder="123456"
                ></lib-input>

                <lib-button type="submit" [disabled]="mfaForm.invalid || loading" class="full-width">
                    {{ loading ? 'Verificando...' : 'Confirmar Código' }}
                </lib-button>
            </form>
        </div>

        <div *ngIf="errorMsg" class="error-banner">
          {{ errorMsg }}
        </div>
      </div>
    </div>
