
    <div class="login-container">
      <div class="login-card">
        <h2>{{ mfaRequired ? 'Verificación de Seguridad' : 'Iniciar Sesión' }}</h2>

        <!-- Context Warning (Only on initial login) -->
        @if (!mfaRequired && contextAnalysis?.discrepancyLevel !== 'none') {
          <div class="context-banner" [class.warning]="contextAnalysis?.discrepancyLevel === 'low'" [class.danger]="contextAnalysis?.discrepancyLevel === 'high'">
            ⚠️ Accediendo desde {{ getCountryName(contextAnalysis?.detectedCountry || '') }} a cuenta {{ getCountryName(country) }}.
          </div>
        }

        @if (!mfaRequired) {
          <div>
            <virteex-country-selector (countrySelected)="onCountrySelected($event)"></virteex-country-selector>

            <form [formGroup]="loginForm" (ngSubmit)="onSubmit()">
            <virteex-input
                label="Correo electrónico"
                formControlName="email"
                placeholder="nombre@empresa.com"
            ></virteex-input>

            <virteex-input
                label="Contraseña"
                type="password"
                formControlName="password"
                placeholder="******"
            ></virteex-input>

            <virteex-button type="submit" [disabled]="loginForm.invalid || loading" class="full-width">
                {{ loading ? 'Verificando...' : 'Iniciar Sesión' }}
            </virteex-button>
            </form>
          </div>
        }

        @if (mfaRequired) {
          <div>
            <p class="mfa-instruction">Hemos detectado un intento de acceso inusual o su cuenta requiere verificación adicional. Ingrese el código enviado a su dispositivo.</p>
            <form [formGroup]="mfaForm" (ngSubmit)="onMfaSubmit()">
                <virteex-input
                    label="Código de Verificación"
                    formControlName="code"
                    placeholder="123456"
                ></virteex-input>

                <virteex-button type="submit" [disabled]="mfaForm.invalid || loading" class="full-width">
                    {{ loading ? 'Verificando...' : 'Confirmar Código' }}
                </virteex-button>
            </form>
          </div>
        }

        @if (errorMsg) {
          <div class="error-banner">
            {{ errorMsg }}
          </div>
        }
      </div>
    </div>
