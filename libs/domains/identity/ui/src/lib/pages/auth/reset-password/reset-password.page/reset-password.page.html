<app-auth-layout>
  <div class="w-full animate-fade-in-up">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-2xl font-bold text-text-primary mb-2">
        {{ 'RESET_PASSWORD.TITLE' | translate }}
      </h1>
      <p class="text-text-secondary text-sm">
        {{ 'RESET_PASSWORD.SUBTITLE' | translate }}
      </p>
    </div>

    <!-- Token Error -->
    @if (!token) {
      <div class="p-4 rounded-xl bg-error/10 border border-error/20 text-error text-center mb-6">
        {{ errorMessage || 'Invalid token' }}
      </div>
    }

    <!-- Success Message -->
    @if (successMessage) {
      <div class="mb-6 p-4 rounded-xl bg-success/10 border border-success/20 text-success text-center animate-fade-in-up">
        <p class="text-sm font-medium">{{ successMessage }}</p>
        <a [routerLink]="['/', languageService.currentLang(), 'auth', 'login']"
          class="mt-2 inline-block text-primary hover:underline">
          {{ 'LOGIN.SUBMIT_BUTTON' | translate }}
        </a>
      </div>
    }

    <!-- Form -->
    @if (token && !successMessage) {
      <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" class="space-y-6">
        <div formGroupName="passwordGroup" class="space-y-4">
          <div class="space-y-1">
            <app-auth-input
              formControlName="password"
              type="password"
              [label]="'REGISTER.PASSWORD' | translate"
              [placeholder]="'REGISTER.PASSWORD_PLACEHOLDER' | translate"
              [required]="true"
              [hasIcon]="true"
              [errorMessage]="getErrorMessage('passwordGroup.password')">
              <svg icon xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            </app-auth-input>
            <app-password-validator [password]="resetPasswordForm.get('passwordGroup.password')?.value"></app-password-validator>
          </div>
          <app-auth-input
            formControlName="confirmPassword"
            type="password"
            [label]="'REGISTER.CONFIRM_PASSWORD' | translate"
            [placeholder]="'REGISTER.CONFIRM_PASSWORD_PLACEHOLDER' | translate"
            [required]="true"
            [hasIcon]="true"
            [errorMessage]="getErrorMessage('passwordGroup.confirmPassword')">
            <svg icon xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </app-auth-input>
          @if (resetPasswordForm.get('passwordGroup')?.errors?.['passwordMismatch'] && resetPasswordForm.get('passwordGroup.confirmPassword')?.touched) {
            <div class="text-xs text-error px-1">
              {{ 'REGISTER.ERRORS.PASSWORD_MISMATCH' | translate }}
            </div>
          }
        </div>
        @if (errorMessage) {
          <div class="p-3 rounded-lg bg-error/10 border border-error/20 text-error text-sm flex items-center gap-2 animate-fade-in-up">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>
            <span>{{ errorMessage }}</span>
          </div>
        }
        <app-auth-button
          type="submit"
          variant="primary"
          [loading]="isLoading"
          [disabled]="resetPasswordForm.invalid">
          {{ (isLoading ? 'RESET_PASSWORD.CHANGING' : 'RESET_PASSWORD.SUBMIT_BUTTON') | translate }}
        </app-auth-button>
      </form>
    }
  </div>
</app-auth-layout>
